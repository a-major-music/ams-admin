// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Address {
  id         Int       @id @default(autoincrement())
  guid       String    @unique @default(uuid())
  address1   String
  address2   String?
  address3   String?
  city       String?
  postcode   String?
  supplier   Supplier? @relation(fields: [supplierId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  supplierId Int       @unique
}

model Contact {
  id         Int      @id @default(autoincrement())
  guid       String   @unique @default(uuid())
  name       String
  email      String?
  phone      String?
  supplier   Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  supplierId Int      @unique
}

model Supplier {
  id             Int             @id @default(autoincrement())
  guid           String          @unique @default(uuid())
  name           String          @unique
  website        String?
  address        Address?
  contacts       Contact[]
  purchaseOrders PurchaseOrder[]
}

model PurchaseOrder {
  id          Int                     @id @default(autoincrement())
  guid        String                  @unique @default(uuid())
  number      String                  @unique
  state       String                  @default("draft")
  issueDate   DateTime?
  pendingXero Boolean                 @default(true)
  lineItems   PurchaseOrderLineItem[]
  subTotal    Int
  taxAmount   Int
  total       Int
  supplier    Supplier?               @relation(fields: [supplierId], references: [id])
  supplierId  Int?
}

model PurchaseOrderLineItem {
  id                  Int                            @id @default(autoincrement())
  guid                String                         @unique @default(uuid())
  variantSku          String?
  variantGuid         String?
  variantUPC          String?
  variantSupplierCode String?
  variantTaxRate      Int
  description         String
  variantMediaURI     String?
  itemCost            Int
  quantityOrdered     Int
  packSize            Int @default(1)
  receipts            PurchaseOrderLineItemReceipt[]
  purchaseOrder       PurchaseOrder                  @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  purchaseOrderId     Int
}

model PurchaseOrderLineItemReceipt {
  id                      Int                    @id @default(autoincrement())
  guid                    String                 @unique @default(uuid())
  date                    DateTime               @default(now())
  received                Int
  receivedPrice           Int
  PurchaseOrderLineItem   PurchaseOrderLineItem? @relation(fields: [purchaseOrderLineItemId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  purchaseOrderLineItemId Int?
}
